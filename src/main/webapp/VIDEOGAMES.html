<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Json</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
            integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
            crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
            integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
            crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
            integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
            crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>
<body>
<nav aria-label="Page navigation example">
    <ul class="pagination">
        <li class="page-item">
            <button id="buttonbefore" type="button" class="page-link">Before</button>
        </li>
        <li class="page-item">
            <button id="buttonafter" type="button" class="page-link">After</button>
        </li>
    </ul>
</nav>
<div id="page">

</div>
<div class="table-responsive">
    <table  class="table table-sm table-striped">
        <thead id="maintable" class="thead-dark">
        </thead>
        <tbody id='mytable'>

        </tbody>
    </table>
</div>


<script>

    var headers = [
        "id",
        "Name",
        "Platform",
        "Year_of_Release",
        "Genre",
        "Publisher",
        "NA_Sales",
        "EU_Sales",
        "JP_Sales",
        "Other_Sales",
        "Global_Sales",
        "Critic_Score",
        "Critic_Count",
        "User_Score",
        "User_Count",
        "Developer",
        "Rating"
    ];
    var page_acuel = 1;
    var nb_lines = 16719;
    var nb_lines_page = 15;
    var sortby = "id";
    function sort(event) {
        var clicks = $(this).data('clicks');
        var param = event.data.sortby;
        //var param = s;

        if (clicks) {
            a({data: {sortby: param + "_rev"}});
        } else {
            a({data: {sortby: param}});
        }
        $(this).data("clicks", !clicks);
    }

    function a(event) {
        if (event.data.sortby === undefined) {
            event.data.sortby = sortby;
        }
        if (event.data.page === undefined) {
            event.data.page = page_acuel;
        } else {
            if (page_acuel + event.data.page > 0 && page_acuel + event.data.page < nb_lines / nb_lines_page) {
                page_acuel += event.data.page;
            } else {
                page_acuel = 1;
            }
        }

        $.ajax("/api/videoGames/all?sortedBy=" + event.data.sortby + "&page=" + page_acuel + "&nb_lines_page=" + nb_lines_page)
            .done(function (arg) {
                $("#mytable").empty();
                $("#page").empty();
                $("#page").append("<h1 class=\"display-4 \" > Page : " + page_acuel + "</h1>");
                $.each(arg, function (index, data) {
                    $("#mytable").append(
                        "<tr><th scope=\"row\">" +
                        data.id +
                        "</th><td>" +
                        data.Name +
                        "</td><td>" +
                        data.Platform +
                        "</td><td>" +
                        data.Year_of_Release +
                        "</td><td>" +
                        data.Genre +
                        "</td><td>" +
                        data.Publisher +
                        "</td><td>" +
                        data.NA_Sales +
                        "</td><td>" +
                        data.EU_Sales +
                        "</td><td>" +
                        data.JP_Sales +
                        "</td><td>" +
                        data.Other_Sales +
                        "</td><td>" +
                        data.Global_Sales +
                        "</td><td>" +
                        data.Critic_Score +
                        "</td><td>" +
                        data.Critic_Count +
                        "</td><td>" +
                        data.User_Score +
                        "</td><td>" +
                        data.User_Count +
                        "</td><td>" +
                        data.Developer +
                        "</td><td>" +
                        data.Rating +
                        "</td></tr>");
                });
            })
            .fail(function () {
                alert("error");
            });
    }

    $(document).ready(function () {

        $.each(headers, function(index,data) {
            $("#maintable")
                .append("<th scope='col' id='col-"+data+"' style='cursor: pointer;'>"+data+"</th>");
            $("#col-" + data)
                .click({sortby: data},sort);
            //.append("<th onclick='sort(\""+data+"\")' scope='col' id='"+data+"'>"+data+"</th>")

            ;
        });

        a({data: {page: 0}});

        $("#buttonbefore").click({page: -1}, a);
        $("#buttonafter").click({page: 1}, a);

    });
</script>
</body>
</html>
